pipeline:

  init:
    action: webdriver:start

  open:
    action: webdriver:open
    # Add any chrome args you need here, e.g.:
    # capabilities:
    #   - --headless=new
    #   - --disable-gpu

  capture:
    action: webdriver:capture-start
    sinkURL: file:///tmp/endly-webdriver-events.jsonl
    flushIntervalMs: 500
    maxBodyBytes: 1000000
    redact: true

  test:
    action: webdriver:run
    navigation:
      timeoutMs: 45000
      autoScrollMs: 5000
      scrollDelayMs: 300
      stableWindowMs: 1500
      maxScrollSteps: 30
    commands:
      - get(http://play.golang.org/?simple=1)
      - (#code).clear
      - (#code).sendKeys(package main

          import "fmt"

          func main() {
              fmt.Println("Hello Endly!")
          }
        )
      - command: (#run).click
      - command: stdout = (.stdout).text
        exit: $stdout.Text:/Endly/
        waitTimeMs: 60000
        repeat: 10

  stopCapture:
    action: webdriver:capture-stop

  defer:
    action: webdriver:stop

